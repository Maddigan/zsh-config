# -*- mode: shell-script -*-
# vim: ft=zsh fdm=marker :

# modified version of this http://zshwiki.org/home/zle/new_widget

autoload -U read-from-minibuffer

perl-edit () {
   local REPLY words
   local NEW
   read-from-minibuffer "Perl: "
   (( $? == 1 )) && return
   if [ -n "$REPLY" ]; then
      NEW="$(echo $CUTBUFFER | perl -pe "$REPLY" 2> /dev/null)"
      (( $? != 0 )) && return
      CUTBUFFER=$NEW
   fi
}
zle -N perl-edit
bindkey "%" perl-edit
